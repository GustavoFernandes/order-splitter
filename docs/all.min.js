function init(){if(window.location.search){var t=window.location.search.substring(1);t=decodeURI(t),handleOrder(function(){return parseQueryStringInput(t)})}loadPreferences()}function loadPreferences(){Storage&&"false"===localStorage.getItem("isTipPercentage")&&(updateTipComponents(!1),document.getElementById("percentageCheckbox").checked=!1)}function onPercentageCheckboxClick(){var t=document.getElementById("percentageCheckbox").checked;updateTipComponents(t),Storage&&localStorage.setItem("isTipPercentage",t)}function updateTipComponents(t){document.getElementById("fixedSpan").hidden=t,document.getElementById("percentageSpan").hidden=!t}function onSplitButtonClick(){var t=document.getElementById("textarea").value,e=Number(document.getElementById("taxes").value),n=Number(document.getElementById("fees").value),r=Number(document.getElementById("tip").value),o=document.getElementById("percentageCheckbox").checked;handleOrder(function(){return parseOrderUpInput(t,n,e,r,o)})}function handleOrder(t){var e=t();e.split(),display(e)}function display(t){var e="<table><tr><td>Subtotal:</td><td>$"+prettifyNumber(t.subtotal)+"</td><td>(user input; sum of item costs)</td></tr><tr><td>Tax:</td><td>$"+prettifyNumber(t.tax)+"</td><td>(user input)</td></tr><tr><td>Fees:</td><td>$"+prettifyNumber(t.fee)+"</td><td>(user input)</td></tr><tr><td>Tip:</td><td>$"+prettifyNumber(t.tip)+"</td><td>("+(t.isTipPercentage?"tip percent * subtotal":"user input")+")</td></tr><tr><td>Total:</td><td>$"+prettifyNumber(t.total)+"</td><td>(subtotal + tax + fees + tip)</td></tr><tr><td>Fees per Person:</td><td>$"+prettifyNumber(t.feesPerPerson)+"</td><td>(fees / number of people)</td></tr><tr><td>Tax (Percent):</td><td>"+t.taxPercent+"%</td><td>(tax / subtotal)</td></tr><tr><td>Tip (Percent):</td><td>"+t.tipPercent+"%</td><td>("+(t.isTipPercentage?"user input":"tip / subtotal")+")</td></tr></table>",n="<hr>"+e+"<br>"+makeBreakdownDisplay(t)+"<br>Publish the following:<br><pre>"+makeTotalsDisplay(t.totals)+"</pre>"+makeHyperlink(t.tax,t.fee,t.tip,t.costs);document.getElementById("result").innerHTML=n}function prettifyNumber(t){t=Math.round(100*t)/100;var e=t.toString();for(e.indexOf(".")===-1&&(e+=".");e.length<e.indexOf(".")+3;)e+="0";return e}function makeTotalsDisplay(t){var e=-1;for(var n in t)e=Math.max(n.length,e);e+=1;var r,o="";for(n in t){r=n;for(var i=n.length;i<e;i++)r+=" ";o+=r+"$"+prettifyNumber(t[n])+"<br>"}return o}function makeHyperlink(t,e,n,r){var o=window.location.origin+window.location.pathname;o.indexOf("index.html")===-1&&(o+="index.html"),o+="?tax="+t+"&fee="+e+"&tip="+n;for(var i in r)o+="&"+i+"="+prettifyNumber(r[i]);return o=encodeURI(o),"<a href="+o+">"+o+"</a>"}function makeBreakdownDisplay(t){var e='<table id="breakdown">';e+="<tr><th>Person</th><th>Item Costs</th><th>Tax</th><th>Tip</th><th>Fees Per Person</th><th>Person Total</th></tr>";for(var n in t.costs){var r=prettifyNumber(t.costs[n]);e+="<tr><td>"+n+"</td><td>"+r+"</td><td> + "+r+" * "+t.taxPercent/100+"</td><td> + "+r+" * "+t.tipPercent/100+"</td><td> + "+t.feesPerPerson+"</td><td> = "+prettifyNumber(t.totals[n])+"</td></tr>"}return e+="</table>"}function Order(t,e,n,r){function o(){t||(console.warn("Fee unset; defaulting to 0"),t=0),e||(console.warn("Tax unset; defaulting to 0"),e=0),n||(console.warn("Tip unset; defaulting to 0"),n=0)}var i=0,a={},d={addItem:function(t,e){null==a[t]&&(a[t]=0),a[t]+=e,i+=e},set fee(e){t=e},set tax(t){e=t},set tip(t){n=t},set isTipPercentage(t){r=t},split:function(){o(),r?(tipPercent=n/100,n=tipPercent*i):tipPercent=n/i,taxPercent=e/i,feesPerPerson=t/Object.keys(a).length,total=i+e+t+n,totals={};for(var d in a)totals[d]=a[d]+a[d]*taxPercent+a[d]*tipPercent+feesPerPerson},get costs(){return a},get fee(){return t},get feesPerPerson(){return feesPerPerson},get tax(){return e},get taxPercent(){return 100*taxPercent},get tip(){return n},get tipPercent(){return 100*tipPercent},get isTipPercentage(){return r},get total(){return total},get subtotal(){return i},get totals(){return totals}};return d.fee=t,d.tax=e,d.tip=n,d.isTipPercentage=r,d}function parseQueryStringInput(t){for(var e=["fee","tax","tip"],n=t.split("&"),r=Order(),o=0;o<n.length;o++){var i=n[o].split("=");i[1]=Number(i[1]),e.indexOf(i[0])>-1?r[i[0]]=i[1]:r.addItem(i[0],i[1])}return r}function parseOrderUpInput(t,e,n,r,o){for(var i=Order(e,n,r,o),a="Label for:",d=null,c=t.split("\n"),u=0;u<c.length;u++){var s=c[u].trim();if(s=s.replace(/\s+/g," "),d){var l=s.indexOf(a);if(l>-1){var f=s.substring(l+a.length,s.length);i.addItem(f,d),d=null}}else{var p=s.indexOf("$");p>-1&&(d=Number(s.substring(p+1,s.length)))}}return i}window.onload=init;